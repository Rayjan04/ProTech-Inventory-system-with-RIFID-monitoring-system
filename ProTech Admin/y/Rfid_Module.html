<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="shorcut icon" type="image" href="../img/logo.jpg">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RFid_Reader</title>

   <!-- DataTables -->
   <link rel="stylesheet" href="plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
   <link rel="stylesheet" href="plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
   <link rel="stylesheet" href="plugins/datatables-buttons/css/buttons.bootstrap4.min.css">

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="css/adminlte.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <!-- The core Firebase JS SDK is always required and must be listed first -->


<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
     <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>

</head>


<body class="sidebar sidebar-collapse" style="height: auto;">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
     <!--   <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>-->
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <h5 onload="RealtimeClocks()" id="Time" class="nav-link"></h5>
      </li>
    
    </ul>

  </nav>
  <!-- /.navbar -->


  <!-- Content Header (Page header) -->
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
       <h1 style="color: red;  ">*Scan your Rfid*</h1>
        </div>
  </section>
              <!-- Main Content-->
<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
          <!-- /.card-header -->
         
               

                    <!-- Main content -->

      <!-- Default box -->
      <div class="card card-solid" id="hide">
        <div class="card-body pb-0">
            <div class="row">
            <!------------------------------------------------------------------->
            <div class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch flex-column">
              </div>
            <div class="col-12 col-sm-6 col-md-4 d-flex align-items-stretch flex-column">
              <div class="card bg-light d-flex flex-fill">
                <div class="card-header text-muted border-bottom-0" id="Position">
               
                </div>
                <div class="card-body pt-0">
                  <div class="row">
                    <div class="col-7">
                      <h2 class="lead"><b  id="Fullname">Jorge Ceballo</b></h2>
                      <p class="text-muted text-sm" id ="RFID"></p>
                      <ul class="ml-4 mb-0 fa-ul text-muted">
                        <li class="small" ><span class="fa-li"><i class="fas fa-lg fa-building" ></i></span><p id="Address"></p></li>
                        <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span><p id="Mobile"></p></li>
                      </ul>
                    </div>
                    <div class="col-5 text-center">
                      <img src="img/IconUser.png" alt="user-avatar" class="img-circle img-fluid">
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <div class="text-right">
                
                  </div>
                </div>
              </div>
            </div>
           <!--------------------------------------------------------------------->
          </div>
        </div>
        </div>
        <!-- /.card-body -->
        </div>
        
          
       
        <!-- /.card -->
        </div>
        </div>
        </div>
        </div>
        </section>
<!-- Main Content style="opacity: 0"  --->

<input type="text"  id="Rfid" style="opacity: 0" >
<input type="text" name="" id="CheckRfid" style="opacity: 0"> 
<input type="text" name="" id="CopyRfid" value="0" style="opacity: 0"> 
<!------------------------------------------------>

<input type="text"  id="LastName" style="opacity: 0">
<input type="text"  id="FirstName" style="opacity: 0">
<input type="text"  id="Position1"style="opacity: 0" >
<input type="text"  id="Times" style="opacity: 0">
<input type="text"  id="LogIn"  style="opacity: 0">
<input type="text"  id="LogOut" style="opacity: 0" >
<input type="text"  id="Date"  style="opacity: 0" >
<!---------------------------------------------------------->
              
<input type="text"  id="NumberPicker" style="opacity: 0"> 
<input type="text"  id="Status" style="opacity: 0">  
<input type="text"  id="Current" style="opacity: 0">  
<!-----------------------------autload---------------------->
<input type="text"  id="load" style="opacity: 0">

<!-- REQUIRED SCRIPTS -->

<!--Time-->
<script src="time.js"></script>
<!-- jQuery -->
<script src="plugins/jquery/jquery.min.js"></script>

<!--datatable-->
<script src="plugins/datatables/jquery.dataTables.min.js"></script>
<script src="plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
<script src="plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
<script src="plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
<script src="plugins/jszip/jszip.min.js"></script>
<script src="plugins/pdfmake/pdfmake.min.js"></script>
<script src="plugins/pdfmake/vfs_fonts.js"></script>
<script src="plugins/datatables-buttons/js/buttons.html5.min.js"></script>
<script src="plugins/datatables-buttons/js/buttons.print.min.js"></script>
<script src="plugins/datatables-buttons/js/buttons.colVis.min.js"></script>


<!-- Bootstrap 4 -->
<script src="../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="../dist/js/adminlte.min.js"></script>
</body>


<script  id=MainScript>
  var firebaseConfig = {
  apiKey: "AIzaSyC5HqUCIRL8XB5X-IGLYg9RiuWCbtiErpY",
  authDomain: "protech-project-aef56.firebaseapp.com",
  projectId: "protech-project-aef56",
  storageBucket: "protech-project-aef56.appspot.com",
  messagingSenderId: "611528722799",
  appId: "1:611528722799:web:814c92195220387825009a",
  measurementId: "G-9B3L95C56G"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
var database = firebase.database();

function Ready(){

  CheckRFID =  document.getElementById("CheckRfid").value;
  RFID =  document.getElementById("CopyRfid").value;
  //---------------------------------------
  LastName =  document.getElementById("LastName").value;
  FirstName =  document.getElementById("FirstName").value;
  Position =  document.getElementById("Position1").value;
  Time1 =  document.getElementById("Times").value;
  Login =  document.getElementById("LogIn").value;
  Logout =  document.getElementById("LogOut").value;
  Date1 =  document.getElementById("Date").value;
  //-----------------------------------------
  Number1 =  document.getElementById("NumberPicker").value;
  Status =  document.getElementById("Status").value;
  Current =  document.getElementById("Current").value;
  //-----------------------------------
  Load =  document.getElementById("load").value;

}

//------------------------------------
                    function auto(){
                      Ready();  
                      

                                  database.ref('Record_Num/').on('value',function(snapshot){
                                  document.getElementById('NumberPicker').value= snapshot.val().Number;
                                   });

                                   database.ref('Autoload/').on('value',function(snapshot){
                                  document.getElementById('load').value= snapshot.val().load;
                                   });
                                   
                                    database.ref('RFID/'+ RFID ).on('value',function(snapshot){
                                     document.getElementById('CheckRfid').value= snapshot.val().RfidNum;
                                     document.getElementById('RFID').innerHTML= snapshot.val().RfidNum;
                             fname = document.getElementById('LastName').value= snapshot.val().LastName;
                             lname = document.getElementById('FirstName').value= snapshot.val().FirstName;
                                     document.getElementById('Mobile').innerHTML= snapshot.val().Mobile;
                                     document.getElementById('Position').innerHTML= snapshot.val().Position;
                                     document.getElementById('Position1').value= snapshot.val().Position;
                                     document.getElementById('Address').innerHTML = snapshot.val().Address;
                                     document.getElementById('Status').value = snapshot.val().Status;
                                     document.getElementById('Current').value = snapshot.val().Current;
                                  });
                             var fullname = fname + " " + lname;
                             document.getElementById('Fullname').innerHTML= fullname;
                             //-----------------------------------------------------
                          
                           
                      }
setInterval(auto, 200);
//-----------------------------------
                        function auto1(){
                        Ready();
                                  if(RFID == CheckRFID){
                                  
                                  $('#hide').slideDown();
                                  }
                                  if(RFID != CheckRFID){               
                                  $('#hide').slideUp();
                                  }
                        }
 setInterval(auto1, 200);
                    


//-----------------------------------------Rfid Scanner--------
                    $(document).ready(function() {
                    Ready();                        
                    $('#hide').hide();

                    //focus to rfid
                    $('#Rfid').focus();
                    $('body').mousemove(function(){
                    $('#Rfid').focus();
                    });

                    $('#Rfid').keydown(function(){
                    if($(this).val().length >= 10){
                      Ready();

                    document.getElementById('CopyRfid').value = document.getElementById('Rfid').value ;
                      $(this).val('');
                              

                      setTimeout(function(){
                   
                                if(Status == "undefined" && RFID == CheckRFID){   
                                  var   Add = ++Number1;                     
                                  database.ref('RFID/'+ RFID).update({
                                      Status: "LogIn",
                                      Current: Add
                                      })
                                     //-------------------------
                                     database.ref('Records/'+ Number1).set({
                                        Date: Date1,
                                        FullName: FirstName + " " +LastName,
                                        ID:CheckRFID,
                                        Position: Position,
                                        Login: Time1,
                                        Logout:"",
                                        })
                                                                    
                                    //AutoLoad
                                   var up = ++Load;
                                    database.ref('Autoload/').set({
                                      load: up
                                      })
                                  }
                                  if(Status == "LogIn" && RFID == CheckRFID){
                                    database.ref('RFID/'+ RFID).update({
                                      Status: "LogOut"
                                      })
                                   
                                       //-------------------------

                                       database.ref('Records/'+ Current).update({
                                        Logout: Time1,
                                        })
                                  //AutoLoad
                                   var up = ++Load;
                                    database.ref('Autoload/').set({
                                      load: up
                                      })
                                  }
                                  if(Status == "LogOut" && RFID == CheckRFID){
                                    var   Add = ++Number1;
                                    database.ref('RFID/'+ RFID).update({
                                      Status: "LogIn",
                                      Current: Add
                                      })
                                      
                                      //----------------------------
                                      database.ref('Record_Num/').update({
                                        Number: Add
                                      })
                                        
                                       //-------------------------
                                       database.ref('Records/'+ Add).set({
                                        Num: Add,
                                        Date: Date1,
                                        FullName: FirstName + " " +LastName,
                                        ID:CheckRFID,
                                        Position: Position,
                                        Login: Time1,
                                        Logout:"",
                                        })

                                    //AutoLoad
                                    var up = ++Load;
                                    database.ref('Autoload/').set({
                                    load: up
                                    })
                                  }
                                  },999)
                    }

                    });

                    });
</script>

<script>
  
function time1() {

//time
var  clock = new Date();
 var hours = clock.getHours();
 var minutes = clock.getMinutes();
 var AmPm = (hours < 12) ? "AM" : "PM";
 hours = (hours > 12) ? hours - 12 : hours;
 hours = ("0" + hours).slice(-2);
 minutes = ("0" + minutes).slice(-2);
//Date
 var today = new Date();
 month = today.getMonth();
 year = today.getFullYear();
 date = today.getDate();

 month = month +1;
 monthA =  ("0" + month).slice(-2);
 date =   ("0" + date).slice(-2);



 document.getElementById("Times").value =  hours + ":" + minutes + " " + AmPm; 
 document.getElementById("Date").value =  month +"-"+ date +"-"+ year;
}

setInterval(time1, 200);

  
</script>

 
</html>
